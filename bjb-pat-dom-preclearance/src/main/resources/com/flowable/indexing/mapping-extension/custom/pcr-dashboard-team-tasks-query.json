{
  "key": "pcr-dashboard-team-tasks-query",
  "type": "query",
  "sourceIndex": "tasks",
  "version": 2,
  "parameters": {
    "creatorUserRole": {
      "type": "string",
      "defaultValue": ""
    },
    "identityLinkType": {
      "type": "string",
      "defaultValue": ""
    },
    "identityLinkUserId": {
      "type": "string",
      "defaultValue": ""
    },
    "identityLinkGroupKey": {
      "type": "string",
      "defaultValue": ""
    },
    "assignee": {
      "type": "string",
      "defaultValue": ""
    }
  },
  "sortParameters": {
  },
  "customFilter": {
    "bool": {
      "must": [
        {
          "match": {
            "pcrCreatorUserRole_text": {
              "query": "{creatorUserRole}",
              "zero_terms_query": "all",
              "operator": "and"
            }
          }
        },
        {
          "terms": {
            "state": ["created", "claimed", "inProgress"]
          }
        },
        {
          "nested": {
            "path": "identityLinks",
            "query": {
              "bool": {
                "should": [
                  {
                    "match": {
                      "identityLinks.type": {
                        "query": "{identityLinkType}",
                        "zero_terms_query": "all",
                        "operator": "and"
                      }
                    }
                  },
                  {
                    "match": {
                      "identityLinks.userId": {
                        "query": "{identityLinkUserId}",
                        "zero_terms_query": "all",
                        "operator": "and"
                      }
                    }
                  },
                  {
                    "match": {
                      "identityLinks.groupId": {
                        "query": "{identityLinkGroupKey}",
                        "zero_terms_query": "all",
                        "operator": "and"
                      }
                    }
                  }
                ],
                "minimum_should_match" : 2
              }
            },
            "score_mode": "none",
            "ignore_unmapped": true
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "assignee": "{assignee}"
          }
        }
      ]
    }
  }
}